# @name Ethernet Modular Test
# @desc Insert/Remove ethernet modules and test CPSW descriptors setting and functionality
# @requires net

ETH_S_FUNC_MODULAR_CPSW_DESCRIPTORS_4096_PING source 'common.sh'; desc_pool=4096; do_cmd install_modules.sh 'net'; net_mod_name=`get_modular_name.sh "net"`;do_cmd "modprobe $net_mod_name"; do_cmd "sleep 10"; iface=`get_eth_iface_name.sh` || die "error getting eth interface name";  do_cmd "ethtool -g ${iface}"; do_cmd "modprobe -r $net_mod_name"; do_cmd "modprobe $net_mod_name descs_pool_size=$desc_pool"; do_cmd "sleep 10"; do_cmd "ethtool -g ${iface}"; host=`get_eth_gateway.sh "-i ${iface}"`|| die "error getting eth gateway address"; do_cmd "ping ${host} -c 3"
ETH_S_PERF_MODULAR_CPSW_DESCRIPTORS_4096_IPERF_UDP_500M_1500B source 'common.sh'; desc_pool=4096; do_cmd install_modules.sh 'net'; net_mod_name=`get_modular_name.sh "net"`;do_cmd "modprobe $net_mod_name"; do_cmd "sleep 10"; iface=`get_eth_iface_name.sh` || die "error getting eth interface name";  do_cmd "ethtool -g ${iface}"; do_cmd "modprobe -r $net_mod_name"; do_cmd "modprobe $net_mod_name descs_pool_size=$desc_pool"; do_cmd "sleep 10";  do_cmd "ethtool -g ${iface}"; run_iperf.sh -w 128k -l 1500 -f M -u -t 60 -b 500M
